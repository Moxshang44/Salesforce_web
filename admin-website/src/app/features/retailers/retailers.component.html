<div class="retailers-layout">
  <app-sidebar></app-sidebar>

  <div class="main-content">
    <app-header></app-header>

    <div class="retailers-content">
      <!-- Page Header -->
      <div class="page-header">
        <h1 class="page-title">Retailers List</h1>
        
        <div class="header-actions">
          <button class="pending-btn" (click)="onPendingApproval()">
            <svg class="bell-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 22C13.1 22 14 21.1 14 20H10C10 21.1 10.9 22 12 22ZM18 16V11C18 7.93 16.37 5.36 13.5 4.68V4C13.5 3.17 12.83 2.5 12 2.5C11.17 2.5 10.5 3.17 10.5 4V4.68C7.64 5.36 6 7.92 6 11V16L4 18V19H20V18L18 16Z" stroke="currentColor" stroke-width="1.5" fill="none"/>
            </svg>
            Pending Approvals
            @if (pendingApprovalsCount > 0) {
              <span class="pending-badge">{{ pendingApprovalsCount }}</span>
            }
          </button>
          <app-button variant="primary" size="sm" (click)="onBulkUpload()">
            <img src="assets/images/bulkupload.png" alt="Bulk Upload" class="button-icon">
            Bulk Upload
          </app-button>
          <app-button variant="primary" size="sm" (click)="onExcel()">
            <img src="assets/images/export.png" alt="Export" class="button-icon">
            Excel
          </app-button>
          <app-button variant="primary" size="sm" (click)="onAdd()">
            <img src="assets/images/add.png" alt="Add" class="button-icon">
            Add
          </app-button>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="filter-section">
        <div class="filter-row">
          <div class="filter-group">
            <select 
              class="filter-select" 
              [(ngModel)]="selectedCountryZone"
              name="countryZone"
            >
              <option value="" disabled selected>Select Country/Zone</option>
              @for (option of countryZoneOptions; track option) {
                <option [value]="option">{{ option }}</option>
              }
            </select>
          </div>

          <div class="filter-group">
            <select 
              class="filter-select" 
              [(ngModel)]="selectedRegion"
              name="region"
            >
              <option value="" disabled selected>Select Region</option>
              @for (option of regionOptions; track option) {
                <option [value]="option">{{ option }}</option>
              }
            </select>
          </div>

          <div class="filter-group">
            <select 
              class="filter-select" 
              [(ngModel)]="selectedArea"
              name="area"
            >
              <option value="" disabled selected>Select Area</option>
              @for (option of areaOptions; track option) {
                <option [value]="option">{{ option }}</option>
              }
            </select>
          </div>

          <div class="filter-group">
            <select 
              class="filter-select" 
              [(ngModel)]="selectedDivision"
              name="division"
            >
              <option value="" disabled selected>Select Division</option>
              @for (option of divisionOptions; track option) {
                <option [value]="option">{{ option }}</option>
              }
            </select>
          </div>
        </div>
      </div>

      <!-- Table Controls -->
      <div class="table-controls">
        <div class="pagination-controls">
          <button class="page-nav" (click)="previousPage()" [disabled]="currentPage === 1">
            <<
          </button>
          <button 
            class="page-number" 
            [class.active]="currentPage === 1"
            (click)="goToPage(1)"
          >
            1
          </button>
          <button 
            class="page-number"
            [class.active]="currentPage === 2"
            (click)="goToPage(2)"
          >
            2
          </button>
          <button class="page-nav" (click)="nextPage()" [disabled]="currentPage === totalPages">
            >>
          </button>
        </div>

        <div class="search-filter">
          <div class="search-box">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <input 
              type="text" 
              placeholder="Q Search..." 
              class="search-input"
              (input)="onSearch($event)"
            />
          </div>
        </div>
      </div>

      <!-- Table Card -->
      <div class="table-card">
        <!-- Data Table -->
        <div class="table-wrapper">
          <table class="retailers-table">
            <thead>
              <tr>
                <th class="col-action">
                  <div class="sortable-header">
                    Action
                    <span class="sort-indicator">
                      <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 0L6 3H2L4 0Z" fill="currentColor"/>
                        <path d="M4 8L2 5H6L4 8Z" fill="currentColor"/>
                      </svg>
                    </span>
                  </div>
                </th>
                <th class="col-details">
                  <div class="sortable-header">
                    Details
                    <span class="sort-indicator">
                      <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 0L6 3H2L4 0Z" fill="currentColor"/>
                        <path d="M4 8L2 5H6L4 8Z" fill="currentColor"/>
                      </svg>
                    </span>
                  </div>
                </th>
                <th class="col-retailer-store">
                  <div class="sortable-header">
                    Retailer Store
                    <span class="sort-indicator">
                      <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 0L6 3H2L4 0Z" fill="currentColor"/>
                        <path d="M4 8L2 5H6L4 8Z" fill="currentColor"/>
                      </svg>
                    </span>
                  </div>
                </th>
                <th class="col-contact">
                  <div class="sortable-header">
                    Contact
                    <span class="sort-indicator">
                      <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 0L6 3H2L4 0Z" fill="currentColor"/>
                        <path d="M4 8L2 5H6L4 8Z" fill="currentColor"/>
                      </svg>
                    </span>
                  </div>
                </th>
                <th class="col-route-address">
                  <div class="sortable-header">
                    Route / Address
                    <span class="sort-indicator">
                      <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 0L6 3H2L4 0Z" fill="currentColor"/>
                        <path d="M4 8L2 5H6L4 8Z" fill="currentColor"/>
                      </svg>
                    </span>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              @for (retailer of retailers; track retailer.id) {
                <tr class="table-row" (click)="onRowClick(retailer)">
                  <td class="col-action" (click)="$event.stopPropagation()">
                    <div class="action-buttons">
                      <button class="action-btn edit" (click)="onEdit(retailer)" title="Edit">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                      <button class="action-btn view" (click)="onView(retailer)" title="View">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                      <button class="action-btn delete" (click)="onDelete(retailer)" title="Delete">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M3 6h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <line x1="10" y1="11" x2="10" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <line x1="14" y1="11" x2="14" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                    </div>
                  </td>
                  <td class="col-details">
                    <button class="view-details-btn" (click)="onView(retailer)">View Details</button>
                  </td>
                  <td class="col-retailer-store">
                    <div class="retailer-store-info">
                      <div class="retailer-name">{{ retailer.name }}</div>
                      <div class="retailer-code">{{ retailer.code }}</div>
                    </div>
                  </td>
                  <td class="col-contact">
                    <div class="contact-info">
                      <div class="contact-name">{{ getContactName(retailer.contact) }}</div>
                      <div class="contact-phone">{{ getContactPhone(retailer.contact, retailer.address) }}</div>
                    </div>
                  </td>
                  <td class="col-route-address">
                    <div class="route-address-info">
                      <div class="route-name">{{ retailer.route }}</div>
                      @if (retailer.address && !isPhoneNumber(retailer.address)) {
                        <div class="route-address">{{ retailer.address }}</div>
                      }
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <!-- Table Footer -->
        <div class="table-footer">
          <p>Showing 1 to 9 of 15 entries</p>
        </div>
      </div>
    </div>

    <!-- Add Retailer Modal -->
    <app-modal
      [isOpen]="isAddModalOpen"
      [title]="getModalTitle()"
      [stepIndicator]="'Step ' + currentStep + ' of 2'"
      width="1400px"
      (close)="closeAddModal()"
    >
      @if (currentStep === 1) {
        <app-retailer-form-step1
          (save)="onSaveStep1($event)"
          (cancel)="closeAddModal()"
        ></app-retailer-form-step1>
      }
      @if (currentStep === 2) {
        <app-retailer-form-step2
          (save)="onSaveStep2($event)"
          (previous)="onPreviousStep()"
        ></app-retailer-form-step2>
      }
    </app-modal>
  </div>
</div>
