<div class="form-container">
  <form class="employee-form">
    <!-- Row 1: Name, Username, Contact Number -->
    <div class="form-row three-col">
      <div class="form-group">
        <label class="form-label">
          Name
          <span class="required">*</span>
        </label>
        <input 
          type="text" 
          class="form-input"
          [class.error]="errors['name']"
          placeholder="e.g., Manoj Badayani"
          [(ngModel)]="formData.name"
          name="name"
          (input)="clearError('name')"
          required
        >
        @if (errors['name']) {
          <span class="error-message">{{ errors['name'] }}</span>
        }
      </div>

      <div class="form-group">
        <label class="form-label">
          Username
          <span class="optional">(Optional)</span>
        </label>
        <input 
          type="text" 
          class="form-input"
          [class.error]="errors['username']"
          placeholder="Enter username"
          [(ngModel)]="formData.username"
          name="username"
          (input)="clearError('username')"
        >
        @if (errors['username']) {
          <span class="error-message">{{ errors['username'] }}</span>
        }
      </div>

      <div class="form-group">
        <label class="form-label">
          Contact Number
          <span class="required">*</span>
        </label>
        <input 
          type="text" 
          class="form-input"
          [class.error]="errors['contact_no']"
          placeholder="e.g., 9876543210"
          [(ngModel)]="formData.contact_no"
          name="contact_no"
          (input)="clearError('contact_no')"
          required
        >
        @if (errors['contact_no']) {
          <span class="error-message">{{ errors['contact_no'] }}</span>
        }
      </div>
    </div>

    <!-- Row 2: Role -->
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">
          Role
          <span class="optional">(Optional)</span>
        </label>
        <select 
          class="form-select"
          [class.error]="errors['role']"
          [(ngModel)]="formData.role"
          name="role"
          [disabled]="isLoadingRoles"
          (change)="clearError('role')"
        >
          <option [value]="''">
            @if (isLoadingRoles) {
              Loading roles...
            } @else {
              Select Role
            }
          </option>
          @for (role of roles; track role.name) {
            <option [value]="role.name">{{ role.name }}</option>
          }
        </select>
        @if (errors['role']) {
          <span class="error-message">{{ errors['role'] }}</span>
        }
        @if (rolesError) {
          <span class="error-message">{{ rolesError }}</span>
        }
      </div>
    </div>

    <!-- Row 3: Select Country, Select Zone, Select Region -->
    <div class="form-row three-col">
      <div class="form-group">
        <label class="form-label">Select Country</label>
        <select 
          class="form-select"
          [class.error]="errors['selectedCountryId']"
          [ngModel]="selectedCountryId"
          (ngModelChange)="onCountryChange($event)"
          name="selectedCountryId"
          [disabled]="isLoadingAllAreas || !selectedCompanyId"
        >
          <option [value]="null">
            @if (isLoadingAllAreas) {
              Loading...
            } @else {
              Select Country
            }
          </option>
          @for (country of countryOptions; track country.id) {
            <option [value]="country.id">{{ country.name }}</option>
          }
        </select>
        @if (errors['selectedCountryId']) {
          <span class="error-message">{{ errors['selectedCountryId'] }}</span>
        }
        @if (isLoadingAllAreas) {
          <span class="form-hint">Loading areas...</span>
        }
      </div>

      <div class="form-group">
        <label class="form-label">Select Zone</label>
        <select 
          class="form-select"
          [class.error]="errors['selectedZoneId']"
          [ngModel]="selectedZoneId"
          (ngModelChange)="onZoneChange($event)"
          name="selectedZoneId"
          [disabled]="!selectedCountryId || isLoadingZones || isLoadingAllAreas"
        >
          <option [value]="null">
            @if (isLoadingZones) {
              Loading zones...
            } @else {
              Select Zone
            }
          </option>
          @for (zone of zoneOptions; track zone.id) {
            <option [value]="zone.id">{{ zone.name }}</option>
          }
        </select>
        @if (errors['selectedZoneId']) {
          <span class="error-message">{{ errors['selectedZoneId'] }}</span>
        }
        @if (isLoadingZones) {
          <span class="form-hint">Loading zones...</span>
        }
      </div>

      <div class="form-group">
        <label class="form-label">Select Region</label>
        <select 
          class="form-select"
          [class.error]="errors['selectedRegionId']"
          [ngModel]="selectedRegionId"
          (ngModelChange)="onRegionChange($event)"
          name="selectedRegionId"
          [disabled]="!selectedZoneId || isLoadingRegions || isLoadingAllAreas"
        >
          <option [value]="null">
            @if (isLoadingRegions) {
              Loading regions...
            } @else {
              Select Region
            }
          </option>
          @for (region of regionOptions; track region.id) {
            <option [value]="region.id">{{ region.name }}</option>
          }
        </select>
        @if (errors['selectedRegionId']) {
          <span class="error-message">{{ errors['selectedRegionId'] }}</span>
        }
        @if (isLoadingRegions) {
          <span class="form-hint">Loading regions...</span>
        }
      </div>
    </div>

    <!-- Row 4: Select Area -->
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">
          Select Area
          <span class="optional">(Optional)</span>
        </label>
        <select 
          class="form-select"
          [class.error]="errors['selectedAreaId']"
          [ngModel]="selectedAreaId"
          (ngModelChange)="onAreaChange($event)"
          name="selectedAreaId"
          [disabled]="!selectedRegionId || isLoadingAreas || isLoadingAllAreas"
        >
          <option [value]="null">
            @if (isLoadingAreas) {
              Loading areas...
            } @else {
              Select Area
            }
          </option>
          @for (area of areaOptions; track area.id) {
            <option [value]="area.id">{{ area.name }}</option>
          }
        </select>
        @if (errors['selectedAreaId']) {
          <span class="error-message">{{ errors['selectedAreaId'] }}</span>
        }
        @if (isLoadingAreas) {
          <span class="form-hint">Loading areas...</span>
        }
      </div>
    </div>

    <!-- Bank Details Section -->
    <div class="form-section">
      <h3 class="section-title">Bank Details <span class="optional">(Optional)</span></h3>
      
      <div class="form-row three-col">
        <div class="form-group">
          <label class="form-label">Account Number</label>
          <input 
            type="text" 
            class="form-input"
            placeholder="Enter account number"
            [(ngModel)]="bankDetails.account_number"
            name="account_number"
          >
        </div>

        <div class="form-group">
          <label class="form-label">Account Name</label>
          <input 
            type="text" 
            class="form-input"
            placeholder="Enter account name"
            [(ngModel)]="bankDetails.account_name"
            name="account_name"
          >
        </div>

        <div class="form-group">
          <label class="form-label">Bank Name</label>
          <input 
            type="text" 
            class="form-input"
            placeholder="Enter bank name"
            [(ngModel)]="bankDetails.bank_name"
            name="bank_name"
          >
        </div>
      </div>

      <div class="form-row three-col">
        <div class="form-group">
          <label class="form-label">Bank Branch</label>
          <input 
            type="text" 
            class="form-input"
            placeholder="Enter bank branch"
            [(ngModel)]="bankDetails.bank_branch"
            name="bank_branch"
          >
        </div>

        <div class="form-group">
          <label class="form-label">Account Type</label>
          <select 
            class="form-select"
            [(ngModel)]="bankDetails.account_type"
            name="account_type"
          >
            @for (type of accountTypes; track type) {
              <option [value]="type">{{ type }}</option>
            }
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">IFSC Code</label>
          <input 
            type="text" 
            class="form-input"
            placeholder="Enter IFSC code"
            [(ngModel)]="bankDetails.ifsc_code"
            name="ifsc_code"
          >
        </div>
      </div>
    </div>

    <!-- Week Schedule Section (for display only, not sent to API) -->
    <div class="schedule-section">
      <div class="schedule-header">
        <h3 class="schedule-title">Days</h3>
        <h3 class="schedule-title">Route</h3>
        <h3 class="schedule-title">Days</h3>
        <h3 class="schedule-title">Route</h3>
      </div>

      <div class="schedule-grid">
        <!-- Monday & Thursday -->
        <div class="schedule-row">
          <div class="day-label">{{ weekSchedule[0].day }}</div>
          <div class="route-select-wrapper">
            <select 
              class="route-select" 
              [(ngModel)]="weekSchedule[0].route_id"
              [name]="'route-' + weekSchedule[0].day"
              [disabled]="isLoadingRoutes"
            >
              <option [value]="null">Disable</option>
              @for (route of routes; track route.id) {
                <option [value]="route.id">{{ route.name }} ({{ route.code }})</option>
              }
            </select>
          </div>
          
          <div class="day-label">{{ weekSchedule[3].day }}</div>
          <div class="route-select-wrapper">
            <select 
              class="route-select" 
              [(ngModel)]="weekSchedule[3].route_id"
              [name]="'route-' + weekSchedule[3].day"
              [disabled]="isLoadingRoutes"
            >
              <option [value]="null">Disable</option>
              @for (route of routes; track route.id) {
                <option [value]="route.id">{{ route.name }} ({{ route.code }})</option>
              }
            </select>
          </div>
        </div>

        <!-- Tuesday & Friday -->
        <div class="schedule-row">
          <div class="day-label">{{ weekSchedule[1].day }}</div>
          <div class="route-select-wrapper">
            <select 
              class="route-select" 
              [(ngModel)]="weekSchedule[1].route_id"
              [name]="'route-' + weekSchedule[1].day"
              [disabled]="isLoadingRoutes"
            >
              <option [value]="null">Disable</option>
              @for (route of routes; track route.id) {
                <option [value]="route.id">{{ route.name }} ({{ route.code }})</option>
              }
            </select>
          </div>
          
          <div class="day-label">{{ weekSchedule[4].day }}</div>
          <div class="route-select-wrapper">
            <select 
              class="route-select" 
              [(ngModel)]="weekSchedule[4].route_id"
              [name]="'route-' + weekSchedule[4].day"
              [disabled]="isLoadingRoutes"
            >
              <option [value]="null">Disable</option>
              @for (route of routes; track route.id) {
                <option [value]="route.id">{{ route.name }} ({{ route.code }})</option>
              }
            </select>
          </div>
        </div>

        <!-- Wednesday & Saturday -->
        <div class="schedule-row">
          <div class="day-label">{{ weekSchedule[2].day }}</div>
          <div class="route-select-wrapper">
            <select 
              class="route-select" 
              [(ngModel)]="weekSchedule[2].route_id"
              [name]="'route-' + weekSchedule[2].day"
              [disabled]="isLoadingRoutes"
            >
              <option [value]="null">Disable</option>
              @for (route of routes; track route.id) {
                <option [value]="route.id">{{ route.name }} ({{ route.code }})</option>
              }
            </select>
          </div>
          
          <div class="day-label">{{ weekSchedule[5].day }}</div>
          <div class="route-select-wrapper">
            <select 
              class="route-select" 
              [(ngModel)]="weekSchedule[5].route_id"
              [name]="'route-' + weekSchedule[5].day"
              [disabled]="isLoadingRoutes"
            >
              <option [value]="null">Disable</option>
              @for (route of routes; track route.id) {
                <option [value]="route.id">{{ route.name }} ({{ route.code }})</option>
              }
            </select>
          </div>
        </div>
      </div>
      @if (isLoadingRoutes) {
        <span class="form-hint">Loading routes...</span>
      }
      @if (routesError) {
        <span class="error-message">{{ routesError }}</span>
      }

      <!-- Route Assignment Date Range and Assign Button -->
      <div class="route-assignment-section">
        <div class="date-range-row">
          <div class="form-group date-field">
            <label class="form-label">From Date <span class="required">*</span></label>
            <input 
              type="date" 
              class="form-input"
              [class.error]="errors['from_date']"
              [(ngModel)]="routeAssignmentFromDate"
              name="from_date"
              (input)="clearError('from_date')"
            >
            @if (errors['from_date']) {
              <span class="error-message">{{ errors['from_date'] }}</span>
            }
          </div>

          <div class="form-group date-field">
            <label class="form-label">To Date</label>
            <input 
              type="date" 
              class="form-input"
              [class.error]="errors['to_date']"
              [(ngModel)]="routeAssignmentToDate"
              name="to_date"
              (input)="clearError('to_date')"
            >
            @if (errors['to_date']) {
              <span class="error-message">{{ errors['to_date'] }}</span>
            }
          </div>

          <div class="assign-button-wrapper">
            <button 
              type="button" 
              class="btn-assign"
              [disabled]="isAssigningRoutes || !isEditMode"
              (click)="onAssignRoutes()"
            >
              @if (isAssigningRoutes) {
                <span class="spinner"></span> Assigning...
              } @else {
                Assign
              }
            </button>
          </div>
        </div>
        @if (!isEditMode) {
          <span class="form-hint assign-hint">Save the employee first to assign routes.</span>
        }
        @if (assignRoutesError) {
          <span class="error-message">{{ assignRoutesError }}</span>
        }
        @if (assignRoutesSuccess) {
          <span class="success-message">{{ assignRoutesSuccess }}</span>
        }
      </div>
    </div>
  </form>

  <!-- Action Buttons -->
  <div class="form-actions">
    <button 
      type="button" 
      class="btn-cancel"
      (click)="onCancel()"
    >
      Cancel
    </button>
    <button 
      type="button" 
      class="btn-save"
      (click)="onSave()"
    >
      Save
    </button>
  </div>
</div>
