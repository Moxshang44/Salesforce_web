<form class="product-form-step4">
  <!-- Images Section -->
  <div class="images-section">
    <h3 class="section-title">Product Images <span class="optional">(Optional)</span></h3>
    <div class="image-upload-section">
      <div class="upload-area" (click)="fileInput.click()">
        <div class="upload-icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <polyline points="17 8 12 3 7 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="12" y1="3" x2="12" y2="15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="upload-text">Drop image files here or click to browse</div>
        <div class="upload-hint">PNG, JPG or GIF (max. 800x400px)</div>
        <input 
          #fileInput
          type="file" 
          accept="image/*" 
          multiple
          (change)="onImageSelect($event)"
          style="display: none"
        />
      </div>

      @if (imagePreviews.length > 0) {
        <div class="image-preview-grid">
          @for (preview of imagePreviews; track $index) {
            <div class="image-preview-item">
              <img [src]="preview" alt="Product image" />
              <button 
                type="button" 
                class="remove-image-btn" 
                (click)="removeImage($index)"
              >
                âœ•
              </button>
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- Visibility Section -->
  <div class="visibility-section">
    <div class="visibility-header">
      <h3 class="section-title">
        Visibility
        <span class="required">*</span>
      </h3>
      <button type="button" class="add-visibility-btn" (click)="addVisibility()">
        + Add Visibility
      </button>
    </div>
    @if (errors['visibility']) {
      <span class="error-message">{{ errors['visibility'] }}</span>
    }

    @for (vis of formData.visibility; track $index) {
        <div class="visibility-card">
          <div class="visibility-card-header">
            <h4>Visibility Entry {{ $index + 1 }}</h4>
            <button type="button" class="remove-visibility-btn" (click)="removeVisibility($index)">
              Remove
            </button>
          </div>

          <div class="form-grid">
            <!-- Area -->
            <div class="form-group">
              <label class="form-label">Area <span class="optional">(Optional)</span></label>
              <select class="form-select" [(ngModel)]="vis.area_id" [name]="'visibility_area_' + $index">
                <option [ngValue]="null">Select Area</option>
                @for (area of areas; track area.id) {
                  <option [ngValue]="area.id">{{ area.name }}</option>
                }
              </select>
            </div>
          </div>

          <!-- Channel Visibility Checkboxes -->
          <div class="checkbox-section">
            <h5>Channel Visibility</h5>
            <div class="checkbox-grid">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  class="checkbox" 
                  [(ngModel)]="vis.for_general" 
                  [name]="'visibility_general_' + $index"
                />
                <span>General Trade</span>
              </label>
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  class="checkbox" 
                  [(ngModel)]="vis.for_modern" 
                  [name]="'visibility_modern_' + $index"
                />
                <span>Modern Trade</span>
              </label>
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  class="checkbox" 
                  [(ngModel)]="vis.for_horeca" 
                  [name]="'visibility_horeca_' + $index"
                />
                <span>HORECA Trade</span>
              </label>
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  class="checkbox" 
                  [(ngModel)]="vis.for_type_a" 
                  [name]="'visibility_type_a_' + $index"
                />
                <span>Type A</span>
              </label>
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  class="checkbox" 
                  [(ngModel)]="vis.for_type_b" 
                  [name]="'visibility_type_b_' + $index"
                />
                <span>Type B</span>
              </label>
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  class="checkbox" 
                  [(ngModel)]="vis.for_type_c" 
                  [name]="'visibility_type_c_' + $index"
                />
                <span>Type C</span>
              </label>
            </div>
          </div>
        </div>
      }
  </div>

  <!-- Form Actions -->
  <div class="form-actions">
    <app-button 
      variant="outline" 
      type="button"
      (click)="onPrevious()"
    >
      Previous
    </app-button>
    <app-button 
      variant="primary" 
      type="button"
      (click)="onSave()"
    >
      Save & Finish
    </app-button>
  </div>
</form>
