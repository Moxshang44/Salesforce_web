<div class="ai-chatbot-layout">
  <!-- DMS Sidebar Navigation -->
  <app-dms-sidebar></app-dms-sidebar>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Header -->
    <app-header></app-header>

    <!-- Chatbot Content -->
    <div class="chatbot-content">
      <!-- Page Title -->
      <div class="page-header">
        <div>
          <h1 class="page-title">AI Chatbot</h1>
          <p class="page-subtitle">Perform operations and tasks with AI assistance</p>
        </div>
      </div>

      <!-- Chatbot Layout with History Sidebar -->
      <div class="chatbot-layout">
        <!-- Chat History Sidebar -->
        <div class="chat-history-sidebar">
          <button class="new-chat-button" (click)="createNewChat()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            New Chat
          </button>
          
          <div class="chat-history-list">
            @for (chat of chatHistory; track chat.id) {
              <div 
                class="chat-history-item" 
                [class.active]="currentChatId === chat.id"
                (click)="selectChat(chat.id)"
              >
                <div class="chat-item-content">
                  <div class="chat-item-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </div>
                  <div class="chat-item-details">
                    <div class="chat-item-title">{{ chat.title }}</div>
                    <div class="chat-item-preview">{{ chat.preview || 'New conversation' }}</div>
                  </div>
                </div>
                <button 
                  class="chat-item-delete" 
                  (click)="deleteChat(chat.id, $event)"
                  title="Delete chat"
                >
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            }
          </div>
        </div>

        <!-- Chat Container -->
        <div class="chatbot-container">
          <div class="chat-messages" #chatMessagesContainer>
          @for (message of chatMessages; track message.id) {
            <div class="message-wrapper" [class.user]="message.role === 'user'" [class.assistant]="message.role === 'assistant'">
              <div class="message-avatar">
                @if (message.role === 'user') {
                  <div class="avatar user-avatar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </div>
                } @else {
                  <div class="avatar assistant-avatar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 2L2 7l10 5 10-5-10-5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M2 17l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </div>
                }
              </div>
              <div class="message-content">
                <div class="message-text">{{ message.content }}</div>
              </div>
            </div>
          }
          @if (isTyping) {
            <div class="message-wrapper assistant">
              <div class="message-avatar">
                <div class="avatar assistant-avatar">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7l10 5 10-5-10-5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 17l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>
              <div class="message-content">
                <div class="typing-indicator">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
              </div>
            </div>
          }
        </div>
          <div class="chat-input-container">
            <div class="chat-input-wrapper">
              <textarea
                class="chat-input"
                [(ngModel)]="chatInput"
                (keydown)="onChatInputKeyPress($event)"
                (input)="onChatInputChange($event)"
                placeholder="Message AI assistant..."
                rows="1"
              ></textarea>
              
              <!-- Attach Button -->
              <button 
                class="attach-button"
                (click)="onAttachClick($event)"
                title="Attach file"
                type="button"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              
              <!-- Mode Dropdown -->
              <div class="mode-dropdown-container" #modeDropdownContainer>
                <button 
                  class="mode-dropdown-button"
                  (click)="toggleModeDropdown()"
                  [title]="getCurrentModeLabel()"
                  type="button"
                >
                  <span class="mode-icon" [innerHTML]="getCurrentModeIconSvg()"></span>
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" [class.open]="showModeDropdown">
                    <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
                
                @if (showModeDropdown) {
                  <div class="mode-dropdown-menu">
                    @for (mode of modes; track mode.value) {
                      <button 
                        class="mode-option"
                        [class.active]="selectedMode === mode.value"
                        (click)="selectMode(mode.value)"
                        type="button"
                      >
                        <span class="mode-option-icon" [innerHTML]="mode.safeIconSvg"></span>
                        <div class="mode-option-content">
                          <div class="mode-option-label">{{ mode.label }}</div>
                          <div class="mode-option-description">{{ mode.description }}</div>
                        </div>
                        @if (selectedMode === mode.value) {
                          <svg class="mode-check" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        }
                      </button>
                    }
                  </div>
                }
              </div>

              <button 
                class="send-button"
                (click)="sendMessage()"
                [disabled]="!chatInput.trim() || isTyping"
                type="button"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
            <div class="chat-footer">
              <span class="chat-hint">AI can make mistakes. Check important info.</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

