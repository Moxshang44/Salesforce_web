<div class="distributors-layout">
  <app-sidebar></app-sidebar>

  <div class="main-content">
    <app-header></app-header>

    <div class="distributors-content">
      <!-- Page Header -->
      <div class="page-header">
        <h1 class="page-title">Distributors List</h1>
        
        <div class="header-actions">
          <app-button variant="primary" size="sm" (click)="onBulkUpload()">
            <img src="assets/images/bulkupload.png" alt="Bulk Upload" class="button-icon">
            Bulk Upload
          </app-button>
          <app-button variant="primary" size="sm" (click)="onExcel()">
            <img src="assets/images/export.png" alt="Export" class="button-icon">
            Excel
          </app-button>
          <app-button variant="primary" size="sm" (click)="onAdd()">
            <img src="assets/images/add.png" alt="Add" class="button-icon">
            Add
          </app-button>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="filter-section">
        <div class="filter-row">
          <div class="filter-group">
            <select 
              class="filter-select" 
              [(ngModel)]="selectedCountryZone"
              name="countryZone"
            >
              <option value="" disabled selected>Select Country/Zone</option>
              @for (option of countryZoneOptions; track option) {
                <option [value]="option">{{ option }}</option>
              }
            </select>
          </div>

          <div class="filter-group">
            <select 
              class="filter-select" 
              [(ngModel)]="selectedRegion"
              name="region"
            >
              <option value="" disabled selected>Select Region</option>
              @for (option of regionOptions; track option) {
                <option [value]="option">{{ option }}</option>
              }
            </select>
          </div>

          <div class="filter-group">
            <select 
              class="filter-select" 
              [(ngModel)]="selectedArea"
              name="area"
            >
              <option value="" disabled selected>Select Area</option>
              @for (option of areaOptions; track option) {
                <option [value]="option">{{ option }}</option>
              }
            </select>
          </div>

          <div class="filter-group">
            <select 
              class="filter-select" 
              [(ngModel)]="selectedSuperStockist"
              name="superStockist"
            >
              <option value="" disabled selected>Select Super Stockist</option>
              @for (option of superStockistOptions; track option) {
                <option [value]="option">{{ option }}</option>
              }
            </select>
          </div>
        </div>
      </div>

      <!-- Table Controls -->
      <div class="table-controls">
        <div class="pagination-controls">
          <button class="page-nav" (click)="previousPage()" [disabled]="currentPage === 1">
            <<
          </button>
          <button 
            class="page-number" 
            [class.active]="currentPage === 1"
            (click)="goToPage(1)"
          >
            1
          </button>
          <button 
            class="page-number"
            [class.active]="currentPage === 2"
            (click)="goToPage(2)"
          >
            2
          </button>
          <button class="page-nav" (click)="nextPage()" [disabled]="currentPage === totalPages">
            >>
          </button>
        </div>

        <div class="search-filter">
          <div class="search-box">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <input 
              type="text" 
              placeholder="Q Search..." 
              class="search-input"
              (input)="onSearch($event)"
            />
          </div>
        </div>
      </div>

      <!-- Table Card -->
      <div class="table-card">
        <!-- Data Table -->
        <div class="table-wrapper">
          <table class="distributors-table">
            <thead>
              <tr>
                <th class="col-action">
                  <div class="sortable-header">
                    Action
                    <span class="sort-indicator">
                      <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 0L6 3H2L4 0Z" fill="currentColor"/>
                        <path d="M4 8L2 5H6L4 8Z" fill="currentColor"/>
                      </svg>
                    </span>
                  </div>
                </th>
                <th class="col-distributor-store">
                  <div class="sortable-header">
                    Distributor Store
                    <span class="sort-indicator">
                      <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 0L6 3H2L4 0Z" fill="currentColor"/>
                        <path d="M4 8L2 5H6L4 8Z" fill="currentColor"/>
                      </svg>
                    </span>
                  </div>
                </th>
                <th class="col-contact">
                  <div class="sortable-header">
                    Contact
                    <span class="sort-indicator">
                      <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 0L6 3H2L4 0Z" fill="currentColor"/>
                        <path d="M4 8L2 5H6L4 8Z" fill="currentColor"/>
                      </svg>
                    </span>
                  </div>
                </th>
                <th class="col-area-address">
                  <div class="sortable-header">
                    Area / Address
                    <span class="sort-indicator">
                      <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 0L6 3H2L4 0Z" fill="currentColor"/>
                        <path d="M4 8L2 5H6L4 8Z" fill="currentColor"/>
                      </svg>
                    </span>
                  </div>
                </th>
                <th class="col-routes-cover">
                  <div class="sortable-header">
                    Routes Cover
                    <span class="sort-indicator">
                      <svg width="8" height="8" viewBox="0 0 8 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 0L6 3H2L4 0Z" fill="currentColor"/>
                        <path d="M4 8L2 5H6L4 8Z" fill="currentColor"/>
                      </svg>
                    </span>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              @for (distributor of distributors; track distributor.id) {
                <tr class="table-row" (click)="onRowClick(distributor)">
                  <td class="col-action" (click)="$event.stopPropagation()">
                    <div class="action-buttons">
                      <button class="action-btn edit" (click)="onEdit(distributor)" title="Edit">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                      <button class="action-btn view" (click)="onView(distributor)" title="View">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                      <button class="action-btn delete" (click)="onDelete(distributor)" title="Delete">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M3 6h18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <line x1="10" y1="11" x2="10" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <line x1="14" y1="11" x2="14" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                    </div>
                  </td>
                  <td class="col-distributor-store">
                    <div class="distributor-store-info">
                      <div class="distributor-name">{{ distributor.name }}</div>
                      <div class="distributor-id">{{ distributor.distributorId }}</div>
                    </div>
                  </td>
                  <td class="col-contact">
                    <div class="contact-info">
                      <div class="contact-name">{{ distributor.contactName }}</div>
                      <div class="contact-phone">{{ distributor.contactPhone }}</div>
                    </div>
                  </td>
                  <td class="col-area-address">
                    <div class="area-address-info">
                      <div class="area-address-text">{{ distributor.areaAddress }}</div>
                    </div>
                  </td>
                  <td class="col-routes-cover">
                    <div class="routes-cover-info">
                      <div class="routes-cover-text">{{ distributor.routesCover }}</div>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <!-- Table Footer -->
        <div class="table-footer">
          <p>Showing 1 to 9 of 15 entries</p>
        </div>
      </div>
    </div>

    <!-- Add Distributor Modal -->
    <app-modal
      [isOpen]="isAddModalOpen"
      [title]="getModalTitle()"
      [stepIndicator]="'Step ' + currentStep + ' of 3'"
      width="1400px"
      (close)="closeAddModal()"
    >
      @if (currentStep === 1) {
        <app-distributor-form-step1
          (save)="onSaveStep1($event)"
          (cancel)="closeAddModal()"
        ></app-distributor-form-step1>
      }
      @if (currentStep === 2) {
        <app-distributor-form-step2
          (save)="onSaveStep2($event)"
          (previous)="onPreviousStep()"
        ></app-distributor-form-step2>
      }
      @if (currentStep === 3) {
        <app-distributor-form-step3
          (save)="onSaveStep3($event)"
          (previous)="onPreviousStep()"
        ></app-distributor-form-step3>
      }
    </app-modal>

    <!-- View Distributor Modal -->
    <app-modal
      [isOpen]="isViewModalOpen"
      [title]="viewingDistributor ? 'View Distributor Details' : 'Distributor Details'"
      width="800px"
      (close)="closeViewModal()"
    >
      @if (viewingDistributor) {
        <div class="view-modal-content">
          <div class="detail-section">
            <h3 class="detail-section-title">Basic Information</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <label class="detail-label">Distributor Name</label>
                <p class="detail-value">{{ viewingDistributor.name }}</p>
              </div>
              <div class="detail-item">
                <label class="detail-label">Distributor ID</label>
                <p class="detail-value">{{ viewingDistributor.distributorId }}</p>
              </div>
              <div class="detail-item">
                <label class="detail-label">Contact Name</label>
                <p class="detail-value">{{ viewingDistributor.contactName }}</p>
              </div>
              <div class="detail-item">
                <label class="detail-label">Contact Phone</label>
                <p class="detail-value">{{ viewingDistributor.contactPhone }}</p>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h3 class="detail-section-title">Location Information</h3>
            <div class="detail-grid">
              <div class="detail-item">
                <label class="detail-label">Area Address</label>
                <p class="detail-value">{{ viewingDistributor.areaAddress }}</p>
              </div>
              <div class="detail-item">
                <label class="detail-label">Routes Coverage</label>
                <p class="detail-value">{{ viewingDistributor.routesCover }}</p>
              </div>
            </div>
          </div>

          <div class="modal-actions">
            <button class="btn-close" (click)="closeViewModal()">Close</button>
          </div>
        </div>
      }
    </app-modal>
  </div>
</div>
